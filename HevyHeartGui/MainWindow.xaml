<Window x:Class="HevyHeartGui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:HevyHeartGui.Converters"
        mc:Ignorable="d"
        Title="HevyHeart - Heart Rate Synchronizer" 
        Height="800" 
        Width="1200"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- Converters -->
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <converters:TimeSpanToStringConverter x:Key="TimeSpanToStringConverter"/>
        <converters:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- DataTemplate for Strava Activities -->
        <DataTemplate x:Key="StravaActivityTemplate">
            <Border Style="{StaticResource Card}" Margin="4">
                <StackPanel>
                    <TextBlock Text="{Binding Name}" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0">
                        <Run Text="Date: "/>
                        <Run Text="{Binding StartDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"/>
                    </TextBlock>
                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}">
                        <Run Text="Type: "/>
                        <Run Text="{Binding Type}"/>
                    </TextBlock>
                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}">
                        <Run Text="Duration: "/>
                        <Run Text="{Binding ElapsedTime, Converter={StaticResource TimeSpanToStringConverter}}"/>
                    </TextBlock>
                    <TextBlock Foreground="{StaticResource AccentBrush}" FontWeight="SemiBold">
                        <Run Text="Avg HR: "/>
                        <Run Text="{Binding AverageHeartrate, StringFormat='{}{0:F0}'}"/>
                        <Run Text=" bpm"/>
                    </TextBlock>
                </StackPanel>
            </Border>
        </DataTemplate>

        <!-- DataTemplate for Hevy Workouts -->
        <DataTemplate x:Key="HevyWorkoutTemplate">
            <Border Style="{StaticResource Card}" Margin="4">
                <StackPanel>
                    <TextBlock Text="{Binding Title}" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0">
                        <Run Text="Date: "/>
                        <Run Text="{Binding StartTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"/>
                    </TextBlock>
                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}">
                        <Run Text="Exercises: "/>
                        <Run Text="{Binding Exercises.Count, Mode=OneWay}"/>
                    </TextBlock>
                    <TextBlock Text="{Binding Description}" 
                               Foreground="{StaticResource TextSecondaryBrush}"
                               TextWrapping="Wrap"
                               MaxWidth="200"
                               Visibility="{Binding Description, Converter={StaticResource StringToVisibilityConverter}}"/>
                </StackPanel>
            </Border>
        </DataTemplate>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Style="{StaticResource Card}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- HevyHeart Banner Image -->
                <Image Grid.Column="0"
                       Source="transparent-banner-cropped.PNG" 
                       Height="156" 
                       Stretch="Uniform"
                       VerticalAlignment="Center"
                       Margin="0,0,16,0"/>
                
                <!-- Text Section -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="Heart Rate Synchronizer" 
                               FontSize="24" 
                               FontWeight="Bold" 
                               Foreground="{StaticResource PrimaryBrush}"
                               Margin="0,0,0,8"/>
                    <TextBlock Text="Sync heart rate data from Strava activities to Hevy workouts" 
                               FontSize="14" 
                               Foreground="{StaticResource TextSecondaryBrush}"
                               TextWrapping="Wrap"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Strava -->
            <Border Grid.Column="0" Style="{StaticResource Card}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Strava Header -->
                    <StackPanel Grid.Row="0">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource StravaLogoGeometry}" Style="{StaticResource StravaPath}"/>
                            <TextBlock Text="Strava Activities" 
                                       FontSize="18" 
                                       FontWeight="Bold" 
                                       Foreground="{StaticResource StravaPrimaryBrush}"/>
                        </StackPanel>
                        <Rectangle Height="2" Fill="{StaticResource StravaPrimaryBrush}" Margin="0,8,0,0"/>
                    </StackPanel>

                    <!-- Strava Authentication -->
                    <StackPanel Grid.Row="1" Margin="0,16,0,0">
                        <Button Style="{StaticResource StravaButton}"
                                Command="{Binding AuthenticateStravaCommand}"
                                Visibility="{Binding IsStravaAuthenticated, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="{StaticResource StravaLogoGeometry}" Style="{StaticResource StravaPath}" Fill="White"/>
                                <TextBlock Text="Authenticate with Strava" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <StackPanel Visibility="{Binding IsStravaAuthenticated, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="{StaticResource CheckmarkIcon}" Style="{StaticResource IconTextBlock}" Foreground="{StaticResource SuccessBrush}"/>
                                <TextBlock Text="Authenticated with Strava" 
                                           Foreground="{StaticResource SuccessBrush}"
                                           FontWeight="SemiBold"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                            <Button Style="{StaticResource StravaButton}"
                                    Command="{Binding LoadStravaActivitiesCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{StaticResource RefreshIcon}" Style="{StaticResource IconTextBlock}" Foreground="White"/>
                                    <TextBlock Text="Reload Activities" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>

                    <!-- Strava Activities List -->
                    <ListBox Grid.Row="2" 
                             Margin="0,16,0,0"
                             ItemsSource="{Binding StravaActivities}"
                             SelectedItem="{Binding SelectedStravaActivity}"
                             ItemTemplate="{StaticResource StravaActivityTemplate}"
                             Style="{StaticResource ModernListBox}"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>

                    <!-- Load Details Button -->
                    <Button Grid.Row="3" 
                            Style="{StaticResource StravaButton}"
                            Command="{Binding LoadActivityDetailsCommand}"
                            Margin="0,8,0,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{StaticResource DownloadIcon}" Style="{StaticResource IconTextBlock}" Foreground="White"/>
                            <TextBlock Text="Load Activity Details" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>

            <!-- Right Panel - Hevy -->
            <Border Grid.Column="2" Style="{StaticResource Card}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Hevy Header -->
                    <StackPanel Grid.Row="0">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource HevyLogoGeometry}" Style="{StaticResource HevyPath}" Fill="{StaticResource HevyPrimaryBrush}"/>
                            <TextBlock Text="Hevy Workouts" 
                                       FontSize="18" 
                                       FontWeight="Bold" 
                                       Foreground="{StaticResource HevyPrimaryBrush}"/>
                        </StackPanel>
                        <Rectangle Height="2" Fill="{StaticResource HevyPrimaryBrush}" Margin="0,8,0,0"/>
                    </StackPanel>

                    <!-- Hevy Authentication -->
                    <StackPanel Grid.Row="1" Margin="0,16,0,0">
                        <StackPanel Visibility="{Binding IsHevyAuthenticated, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                            <TextBlock Text="Email or Username:" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,4"/>
                            <TextBox Text="{Binding HevyEmailOrUsername, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource ModernTextBox}"
                                     Margin="0,0,0,8"/>
                            
                            <TextBlock Text="Password:" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,4"/>
                            <PasswordBox x:Name="HevyPasswordBox"
                                         Style="{StaticResource ModernPasswordBox}"
                                         Margin="0,0,0,8"
                                         PasswordChanged="HevyPasswordBox_PasswordChanged"/>
                            
                            <Button Style="{StaticResource HevyButton}"
                                    Command="{Binding AuthenticateHevyCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="{StaticResource HevyLogoGeometry}" Style="{StaticResource HevyPath}" Fill="White"/>
                                    <TextBlock Text="Authenticate with Hevy" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                        
                        <StackPanel Visibility="{Binding IsHevyAuthenticated, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="{StaticResource CheckmarkIcon}" Style="{StaticResource IconTextBlock}" Foreground="{StaticResource SuccessBrush}"/>
                                <TextBlock Text="Authenticated with Hevy" 
                                           Foreground="{StaticResource SuccessBrush}"
                                           FontWeight="SemiBold"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                            <Button Style="{StaticResource HevyButton}"
                                    Command="{Binding LoadHevyWorkoutsCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{StaticResource RefreshIcon}" Style="{StaticResource IconTextBlock}" Foreground="White"/>
                                    <TextBlock Text="Reload Workouts" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>

                    <!-- Hevy Workouts List -->
                    <ListBox Grid.Row="2" 
                             Margin="0,16,0,0"
                             ItemsSource="{Binding HevyWorkouts}"
                             SelectedItem="{Binding SelectedHevyWorkoutItem}"
                             ItemTemplate="{StaticResource HevyWorkoutTemplate}"
                             Style="{StaticResource ModernListBox}"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Footer -->
        <Border Grid.Row="2" Style="{StaticResource Card}" Margin="0,16,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Watch Type Selection - Always visible when ready to sync -->
                <Border Grid.Row="0"
                        Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource PrimaryBrush}"
                        BorderThickness="2"
                        CornerRadius="4"
                        Padding="16"
                        Margin="0,0,0,12">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Text="?" 
                                       FontSize="20"
                                       Margin="0,0,8,0"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="Device Used for Biometrics" 
                                       FontSize="15" 
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="Select the watch or device that recorded this workout's heart rate data:" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontSize="12"
                                   Margin="0,0,0,10"
                                   TextWrapping="Wrap"/>
                        <StackPanel Orientation="Horizontal">
                            <RadioButton IsChecked="{Binding SelectedWatchType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=None}"
                                         GroupName="WatchType"
                                         Foreground="{StaticResource TextPrimaryBrush}"
                                         FontSize="13"
                                         Margin="0,0,20,0"
                                         ToolTip="Heart rate data from manual entry or other source">
                                <TextBlock Text="None (Manual Entry)" FontFamily="Segoe UI"/>
                            </RadioButton>
                            <RadioButton IsChecked="{Binding SelectedWatchType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=AppleWatch}"
                                         GroupName="WatchType"
                                         Foreground="{StaticResource TextPrimaryBrush}"
                                         FontSize="13"
                                         Margin="0,0,20,0"
                                         ToolTip="Workout recorded with Apple Watch">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Apple Watch" FontFamily="Segoe UI"/>
                                </StackPanel>
                            </RadioButton>
                            <RadioButton IsChecked="{Binding SelectedWatchType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=WearOS}"
                                         GroupName="WatchType"
                                         Foreground="{StaticResource TextPrimaryBrush}"
                                         FontSize="13"
                                         ToolTip="Workout recorded with WearOS device">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="WearOS" FontFamily="Segoe UI"/>
                                </StackPanel>
                            </RadioButton>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Sync Summary -->
                <Border Grid.Row="1" 
                        Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12"
                        Margin="0,0,0,12"
                        Visibility="{Binding SyncSummary, Converter={StaticResource StringToVisibilityConverter}}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="{StaticResource ChartIcon}" Style="{StaticResource IconTextBlock}" Foreground="{StaticResource AccentBrush}"/>
                            <TextBlock Text="Synchronization Preview" 
                                       FontSize="14" 
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="{Binding SyncSummary}" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontFamily="Consolas"/>
                    </StackPanel>
                </Border>

                <!-- Status Bar -->
                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="{Binding StatusMessage}" 
                               Foreground="{StaticResource TextPrimaryBrush}"
                               FontSize="14"
                               VerticalAlignment="Center"/>

                    <ProgressBar Grid.Column="1" 
                                 Width="150" 
                                 Height="6"
                                 IsIndeterminate="True"
                                 Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                                 VerticalAlignment="Center"
                                 Margin="8,0,0,0"/>
                </Grid>

                <!-- Synchronize Button -->
                <Button Grid.Row="3" 
                        Style="{StaticResource ModernButton}"
                        Command="{Binding SynchronizeCommand}"
                        FontSize="16"
                        Padding="24,12"
                        Margin="0,12,0,0"
                        HorizontalAlignment="Center">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{StaticResource SyncIcon}" Style="{StaticResource LargeIconTextBlock}" Foreground="White"/>
                        <TextBlock Text="Synchronize Heart Rate Data" VerticalAlignment="Center"/>
                    </StackPanel>
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="6"/>
                        </Style>
                    </Button.Resources>
                </Button>
            </Grid>
        </Border>
    </Grid>
</Window>
