<Window x:Class="HevyHeartGui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:HevyHeartGui.Converters"
        mc:Ignorable="d"
        Title="HevyHeart - Heart Rate Synchronizer" 
        Height="800" 
        Width="1200"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- Converters -->
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <converters:TimeSpanToStringConverter x:Key="TimeSpanToStringConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- DataTemplate for Strava Activities -->
        <DataTemplate x:Key="StravaActivityTemplate">
            <Border Style="{StaticResource Card}" Margin="4">
                <StackPanel>
                    <TextBlock Text="{Binding Name}" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0">
                        <Run Text="Date: "/>
                        <Run Text="{Binding StartDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"/>
                    </TextBlock>
                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}">
                        <Run Text="Type: "/>
                        <Run Text="{Binding Type}"/>
                    </TextBlock>
                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}">
                        <Run Text="Duration: "/>
                        <Run Text="{Binding ElapsedTime, Converter={StaticResource TimeSpanToStringConverter}}"/>
                    </TextBlock>
                    <TextBlock Foreground="{StaticResource AccentBrush}" FontWeight="SemiBold">
                        <Run Text="Avg HR: "/>
                        <Run Text="{Binding AverageHeartrate, StringFormat='{}{0:F0}'}"/>
                        <Run Text=" bpm"/>
                    </TextBlock>
                </StackPanel>
            </Border>
        </DataTemplate>

        <!-- DataTemplate for Hevy Workouts -->
        <DataTemplate x:Key="HevyWorkoutTemplate">
            <Border Style="{StaticResource Card}" Margin="4">
                <StackPanel>
                    <TextBlock Text="{Binding Title}" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0">
                        <Run Text="Date: "/>
                        <Run Text="{Binding StartTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"/>
                    </TextBlock>
                    <TextBlock Foreground="{StaticResource TextSecondaryBrush}">
                        <Run Text="Exercises: "/>
                        <Run Text="{Binding Exercises.Count, Mode=OneWay}"/>
                    </TextBlock>
                    <TextBlock Text="{Binding Description}" 
                               Foreground="{StaticResource TextSecondaryBrush}"
                               TextWrapping="Wrap"
                               MaxWidth="200"
                               Visibility="{Binding Description, Converter={StaticResource StringToVisibilityConverter}}"/>
                </StackPanel>
            </Border>
        </DataTemplate>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Style="{StaticResource Card}">
            <StackPanel>
                <TextBlock Text="HevyHeart - Heart Rate Synchronizer" 
                           FontSize="24" 
                           FontWeight="Bold" 
                           Foreground="{StaticResource PrimaryBrush}"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="Sync heart rate data from Strava activities to Hevy workouts" 
                           FontSize="14" 
                           Foreground="{StaticResource TextSecondaryBrush}"
                           HorizontalAlignment="Center"
                           Margin="0,4,0,0"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Strava -->
            <Border Grid.Column="0" Style="{StaticResource Card}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Strava Header -->
                    <StackPanel Grid.Row="0">
                        <TextBlock Text="?? Strava Activities" 
                                   FontSize="18" 
                                   FontWeight="Bold" 
                                   Foreground="{StaticResource PrimaryBrush}"/>
                        <Rectangle Height="2" Fill="{StaticResource PrimaryBrush}" Margin="0,8,0,0"/>
                    </StackPanel>

                    <!-- Strava Authentication -->
                    <StackPanel Grid.Row="1" Margin="0,16,0,0">
                        <Button Content="?? Authenticate with Strava" 
                                Style="{StaticResource ModernButton}"
                                Command="{Binding AuthenticateStravaCommand}"
                                Visibility="{Binding IsStravaAuthenticated, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        
                        <StackPanel Visibility="{Binding IsStravaAuthenticated, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="? Authenticated with Strava" 
                                       Foreground="{StaticResource SuccessBrush}"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,8"/>
                            <Button Content="?? Reload Activities" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding LoadStravaActivitiesCommand}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Strava Activities List -->
                    <ListBox Grid.Row="2" 
                             Margin="0,16,0,0"
                             ItemsSource="{Binding StravaActivities}"
                             SelectedItem="{Binding SelectedStravaActivity}"
                             ItemTemplate="{StaticResource StravaActivityTemplate}"
                             Style="{StaticResource ModernListBox}"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>

                    <!-- Load Details Button -->
                    <Button Grid.Row="3" 
                            Content="?? Load Activity Details" 
                            Style="{StaticResource ModernButton}"
                            Command="{Binding LoadActivityDetailsCommand}"
                            Margin="0,8,0,0"/>
                </Grid>
            </Border>

            <!-- Right Panel - Hevy -->
            <Border Grid.Column="2" Style="{StaticResource Card}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Hevy Header -->
                    <StackPanel Grid.Row="0">
                        <TextBlock Text="?? Hevy Workouts" 
                                   FontSize="18" 
                                   FontWeight="Bold" 
                                   Foreground="{StaticResource PrimaryBrush}"/>
                        <Rectangle Height="2" Fill="{StaticResource PrimaryBrush}" Margin="0,8,0,0"/>
                    </StackPanel>

                    <!-- Hevy Authentication -->
                    <StackPanel Grid.Row="1" Margin="0,16,0,0">
                        <StackPanel Visibility="{Binding IsHevyAuthenticated, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                            <TextBlock Text="Email or Username:" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,4"/>
                            <TextBox Text="{Binding HevyEmailOrUsername, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource ModernTextBox}"
                                     Margin="0,0,0,8"/>
                            
                            <TextBlock Text="Password:" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,4"/>
                            <PasswordBox x:Name="HevyPasswordBox"
                                         Style="{StaticResource ModernPasswordBox}"
                                         Margin="0,0,0,8"
                                         PasswordChanged="HevyPasswordBox_PasswordChanged"/>
                            
                            <Button Content="?? Authenticate with Hevy" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding AuthenticateHevyCommand}"/>
                        </StackPanel>
                        
                        <StackPanel Visibility="{Binding IsHevyAuthenticated, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="? Authenticated with Hevy" 
                                       Foreground="{StaticResource SuccessBrush}"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,8"/>
                            <Button Content="?? Reload Workouts" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding LoadHevyWorkoutsCommand}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Hevy Workouts List -->
                    <ListBox Grid.Row="2" 
                             Margin="0,16,0,0"
                             ItemsSource="{Binding HevyWorkouts}"
                             SelectedItem="{Binding SelectedHevyWorkoutItem}"
                             ItemTemplate="{StaticResource HevyWorkoutTemplate}"
                             Style="{StaticResource ModernListBox}"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Footer -->
        <Border Grid.Row="2" Style="{StaticResource Card}" Margin="0,16,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Sync Summary -->
                <Border Grid.Row="0" 
                        Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12"
                        Margin="0,0,0,12"
                        Visibility="{Binding SyncSummary, Converter={StaticResource StringToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="?? Synchronization Summary" 
                                   FontSize="14" 
                                   FontWeight="Bold"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   Margin="0,0,0,8"/>
                        <TextBlock Text="{Binding SyncSummary}" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontFamily="Consolas"/>
                    </StackPanel>
                </Border>

                <!-- Status Bar -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="{Binding StatusMessage}" 
                               Foreground="{StaticResource TextPrimaryBrush}"
                               FontSize="14"
                               VerticalAlignment="Center"/>

                    <ProgressBar Grid.Column="1" 
                                 Width="150" 
                                 Height="6"
                                 IsIndeterminate="True"
                                 Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                                 VerticalAlignment="Center"
                                 Margin="8,0,0,0"/>
                </Grid>

                <!-- Synchronize Button -->
                <Button Grid.Row="2" 
                        Content="?? Synchronize Heart Rate Data" 
                        Style="{StaticResource ModernButton}"
                        Command="{Binding SynchronizeCommand}"
                        FontSize="16"
                        Padding="24,12"
                        Margin="0,12,0,0"
                        HorizontalAlignment="Center">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="6"/>
                        </Style>
                    </Button.Resources>
                </Button>
            </Grid>
        </Border>
    </Grid>
</Window>
